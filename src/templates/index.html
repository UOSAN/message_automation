<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Smoking study message generation</title>
    <link rel="stylesheet" href="../static/bulma.css">
</head>
<body>
  <div class="container scale-in-center">
    <br><br>
    <div><h1 class="title is-4">Smoking study message generation</h1></div>
    <div class="content">
        <form method="post" enctype="multipart/form-data" id="upload">
        <!--  Participant ID -->
        <br><br>
        <div class="columns">
            <div class="column is-one-fifth">
                <label for="participant">Participant ID</label>
            </div>
            <div class="column is-one-fifth">
                <input name="participant" id="participant" type="text">
            </div>
        </div>
        </form>

        <br><br>
        <button id="validate" class="button is-link" >Validate ID</button>
        <br><br>
        <button id="diary" class="button is-link" >Generate DD1 and quit date</button>
        <br><br>
        <button id="task" class="button is-link" >Generate value task input</button>
        <br><br>
        <button id="messages" class="button is-link" >Generate intervention SMS and DD3</button>
        <br><br>
        <button id="count" class="button is-link" >Participant responses</button>
        <br><br>
        <button id="delete" class="button is-link" >Delete messages</button>
        <br><br>
        <button id="downloads" class="button is-link" >Go to downloads page</button>
        <br><br>


        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <ul class=flashes>
          {% for category, message in messages %}
          <li class="tag is-{{ category }}">{{ message }}</li>
          {% endfor %}
        </ul>
        {% endif %}
        {% endwith %}

        <iframe id="progress"
            title="thread progress"
            width="640"
            height="200"
            src="progress">
        </iframe>
    </div>
  </div>
</body>

<script type="text/javascript">
    document.addEventListener('DOMContentLoaded', () => {
         document.querySelectorAll('button').forEach(button => {
            button.onclick = () => {
                const request = new XMLHttpRequest();
                request.open('POST', `/${button.id}`);
                request.onload = () => {
                    document.getElementById('progress').contentWindow.location.reload(true);

                };
                const form = document.getElementById( "upload" );
                const formdata = new FormData(form);
                request.send(formdata);
            };
        });
    });
</script>
<!--
<script type="text/javascript">
document.addEventListener('keypress', function (e) {
        if (e.keyCode === 13 || e.which === 13) {
            e.preventDefault();
            const request = new XMLHttpRequest();
            request.open('POST', {{ url_for('blueprints.validate') }} );
            request.onload = () => {
                document.getElementById('progress').contentWindow.location.reload(true);
            };
            const form = document.getElementById( "upload" );
            const formdata = new FormData(form);
            request.send(formdata);
        }

    });
</script>
-->
<script src="http://code.jquery.com/jquery-3.1.1.js"></script>
<!--  disable enter key -->

<script type="text/javascript">
$(document).keypress(
  function(event){
    if (event.which == '13') {
        event.preventDefault();
        document.getElementById('validate').click();
    }
});
</script>


<!--  periodically refresh progress log  -->
<script type="text/javascript">
    function doRefresh(){
        document.getElementById('progress').contentWindow.location.reload(true);
    }
    $(function() {
        setInterval(doRefresh, 10000);
    });
</script>
        <!--
        const request = new XMLHttpRequest();
        request.open('POST', {{ url_for('blueprints.validate') }} );
        request.onload = () => {
            document.getElementById('progress').contentWindow.location.reload(true);
        };
        const form = document.getElementById( "upload" );
        const formdata = new FormData(form);
        request.send(formdata);
        -->
</html>